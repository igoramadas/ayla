#api.page(data-bind="page: {id: 'api', title: 'API Module', withOnShow: bindPage('ApiModule')}")
    h1(data-biond="text: title")
    ul.maingrid.small-block-grid-1
        li
            dl.tabs(data-tab)
                dd
                    a(href="#about", title="About this module") about
                dd
                    a(href="#settings", title="Module's settings") settings
                dd(data-bind="if: oauth")
                    a(href="#oauth", title="OAuth parameters") oauth
                dd
                    a(href="#errors", title="Errors triggered by this module") errors
                dd
                    a(href="#jobs", title="Scheduled jobs") jobs

                // ko foreach: Object.keys(data)
                dd.data
                    a(data-bind="text: $data, attr: {href: '#data' + $data}")
                // /ko

            .tabs-content
                #about.content.panel
                    .inner-panel !{description}
                    .inner-panel
                        a(data-bind="attr: {href: 'https://ayla.codeplex.com/wikipage?title=API:%20#' + name}", target="AylaDocs") View online documentation

                #settings.content.panel
                    h5 settings.#{title.toLowerCase()}
                    .inner-panel
                        .data-table !{JSON.stringify(settings[title.toLowerCase()])}

                #oauth.content.panel(data-bind="if: oauth")
                    .inner-panel.auth
                        div
                            span.info Authenticated:
                            span(data-bind="text: oauth.authenticated")
                        div.clip(data-bind="if: oauth.authenticated, with: oauth")
                            span.info Token:
                            span(data-bind="text: data.token || data.accessToken")
                            br
                            span.info Expires:
                            span(data-bind="if: oauth.data.expires > 0, text: moment(data.expires * 1000).format('lll')")
                            span(data-bind="if: oauth.data.expires < 1") No expiration date set
                        div
                            a.button(href="/auth") Trigger authentication

                #errors.content.panel
                    div(data-bind="if: errors.length > 0")
                        // ko foreach: errors
                        h5(data-bind="text: moment(timestamp).format('YYYY-MM-DD HH:mm:ss') + ': ' + data[0]")
                        .inner-panel.error-details
                            span(data-bind="data.join(', ')")
                        // /ko

                    .inner-panel(data-bind="if: errors.length < 1")
                        span No errors found.

                #jobs.content.panel
                    table(data-bind="if: jobs.length > 0")
                        thead
                            th Job
                            th Schedule
                            th Last run
                        tbody
                            // ko foreach: jobs
                            tr
                                td
                                    span(data-bind="text: id")
                                td
                                    // ko if: isNaN(schedule)
                                    span(data-bind=" text: schedule.join(', ')")
                                    // /ko
                                    // ko if: !isNaN(schedule)
                                    span(data-bind="text: 'every ' + schedule + ' seconds'")
                                    // /ko
                                td
                                    // ko if: endTime.year() > 2000
                                    span(data-bind="text: endTime.format('lll')")
                                    // /ko
                                    // ko if: endTime.year() > 2000
                                    span(data-bind="if: endTime.year() <= 2000") Never
                                    // /ko
                            // /ko

                    .inner-panel(data-bind="if: jobs.length < 1") No scheduled jobs.

                // ko foreach: data
                .content.panel.data(data-bind="attr: {id: 'data-#' + id}")
                    // ko foreach: value
                    h5(data-bind="text: JSON.stringify(filter, null, 2) + ' ' + moment(timestamp * 1000).format('lll')")
                    .inner-panel
                        .data-table(data-bind="html: JsonHuman.format(JSON.stringify(value)).innerHTML")
                    // /ko
                // /ko
